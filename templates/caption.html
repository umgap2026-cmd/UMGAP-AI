{% extends "base.html" %} {% block content %}
<style>
  .cap-wrap {
    max-width: 1100px;
    margin: 0 auto;
  }
  .cap-head {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
    align-items: flex-start;
  }
  .cap-head h2 {
    margin: 0;
    font-size: 18px;
  }
  .cap-head .muted {
    margin-top: 6px;
  }
  .cap-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 14px;
    margin-top: 14px;
  }
  @media (min-width: 980px) {
    .cap-grid {
      grid-template-columns: 0.95fr 1.05fr;
    }
  }
  .cardx {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
    padding: 14px;
  }

  .toolbar {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
    margin-top: 12px;
  }
  .btn-ghost {
    border: 1px solid var(--border);
    background: #fff;
    border-radius: 14px;
    padding: 10px 12px;
    font-weight: 900;
    cursor: pointer;
    display: inline-flex;
    gap: 8px;
    align-items: center;
  }
  .pill {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: #f8faff;
    font-size: 12px;
    font-weight: 900;
    color: var(--muted);
  }
  .pill b {
    color: var(--text);
  }

  label {
    display: block;
    font-size: 12px;
    font-weight: 900;
    color: var(--muted);
    margin: 10px 0 6px;
  }
  input,
  select,
  textarea {
    width: 100%;
    padding: 12px 12px;
    border-radius: 14px;
    border: 1px solid var(--border);
    background: #fff;
    outline: none;
    font-size: 14px;
  }
  textarea {
    min-height: 220px;
    resize: vertical;
    line-height: 1.55;
  }
  @media (max-width: 640px) {
    input,
    select,
    textarea {
      padding: 14px;
      font-size: 16px;
    }
  }

  .btnbar {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 12px;
  }
  .btn-primary {
    border: 0;
    background: var(--primary);
    color: #fff;
    border-radius: 14px;
    padding: 12px 14px;
    font-weight: 1000;
    cursor: pointer;
    flex: 1;
    min-width: 180px;
  }
  .btn-primary:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }
  .mini {
    font-size: 12px;
    color: var(--muted);
    margin-top: 8px;
  }

  /* ====== SUPER LOADING (lebih keren) ====== */
  .overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 22px;
    background:
      radial-gradient(
        900px 420px at 12% -10%,
        rgba(37, 99, 235, 0.28) 0%,
        transparent 60%
      ),
      radial-gradient(
        700px 360px at 105% 0%,
        rgba(245, 158, 11, 0.2) 0%,
        transparent 55%
      ),
      rgba(15, 23, 42, 0.28);
    backdrop-filter: blur(8px);
  }
  .overlay.show {
    display: flex;
  }
  .loader {
    width: min(520px, 100%);
    border-radius: 26px;
    border: 1px solid rgba(255, 255, 255, 0.25);
    background: rgba(255, 255, 255, 0.72);
    box-shadow: 0 30px 90px rgba(2, 6, 23, 0.3);
    overflow: hidden;
  }
  .loader-top {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 16px 16px 12px;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.85),
      rgba(255, 255, 255, 0.55)
    );
  }
  .orb {
    width: 54px;
    height: 54px;
    border-radius: 18px;
    background: conic-gradient(from 180deg, #2563eb, #60a5fa, #a78bfa, #2563eb);
    position: relative;
    animation: spin 1.2s linear infinite;
  }
  .orb:after {
    content: "";
    position: absolute;
    inset: 6px;
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.88);
    border: 1px solid rgba(37, 99, 235, 0.18);
  }
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
  .loader-title {
    min-width: 0;
  }
  .loader-title h3 {
    margin: 0;
    font-size: 15px;
  }
  .typing {
    margin-top: 6px;
    font-size: 12px;
    color: var(--muted);
    font-weight: 800;
    white-space: nowrap;
    overflow: hidden;
    width: 0ch;
    animation: type 1.6s steps(22, end) infinite alternate;
  }
  @keyframes type {
    from {
      width: 0ch;
    }
    to {
      width: 22ch;
    }
  }
  .sparkline {
    height: 54px;
    margin-left: auto;
    opacity: 0.9;
    display: flex;
    align-items: flex-end;
    gap: 4px;
  }
  .sparkline i {
    width: 6px;
    border-radius: 999px;
    background: rgba(37, 99, 235, 0.85);
    animation: bar 1s infinite ease-in-out;
  }
  .sparkline i:nth-child(2) {
    animation-delay: 0.08s;
  }
  .sparkline i:nth-child(3) {
    animation-delay: 0.16s;
  }
  .sparkline i:nth-child(4) {
    animation-delay: 0.24s;
  }
  .sparkline i:nth-child(5) {
    animation-delay: 0.32s;
  }
  @keyframes bar {
    0%,
    100% {
      height: 10px;
      opacity: 0.45;
    }
    50% {
      height: 48px;
      opacity: 1;
    }
  }

  .shimmer {
    position: relative;
    height: 12px;
    margin: 0 16px 16px;
    border-radius: 999px;
    background: rgba(2, 6, 23, 0.06);
    overflow: hidden;
  }
  .shimmer:before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(37, 99, 235, 0.25),
      transparent
    );
    transform: translateX(-60%);
    animation: shine 1.1s infinite;
  }
  @keyframes shine {
    to {
      transform: translateX(160%);
    }
  }

  .loader-body {
    padding: 0 16px 16px;
  }
  .chips {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 10px;
  }
  .chip {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.85);
    border: 1px solid rgba(2, 6, 23, 0.08);
    font-size: 12px;
    font-weight: 900;
    color: var(--muted);
  }
  .chip b {
    color: var(--text);
  }

  .hint {
    margin-top: 10px;
    font-size: 12px;
    color: var(--muted);
    line-height: 1.4;
  }
</style>

<div class="cap-wrap">
  <div class="cardx cap-head">
    <div>
      <h2>AI Caption</h2>
      <div class="muted">Tulis produk ‚Üí caption jadi ‚Üí tinggal copy.</div>

      <div class="toolbar">
        <div class="pill">‚ö° Mode <b>AI</b></div>
        <div class="pill">üìù Output <b>ringkas</b></div>
      </div>
    </div>
  </div>

  <div class="cap-grid">
    <div class="cardx">
      <form method="POST" action="/caption/ai" id="capForm">
        <label>Nama Produk</label>
        <input
          name="product"
          required
          placeholder="Contoh: Kopi Susu Gula Aren"
        />

        <label>Harga (opsional)</label>
        <input name="price" placeholder="Contoh: 15.000" />

        <label>Gaya Caption</label>
        <select name="style">
          <option value="Santai">Santai</option>
          <option value="Promo">Promo</option>
          <option value="Serius">Serius</option>
        </select>

        <div class="btnbar">
          <button class="btn-primary" id="btnGen">‚ú® Generate</button>
          <button type="button" class="btn-ghost" id="btnReset">Reset</button>
        </div>

        <div class="mini">
          Animasi loading akan muncul saat proses generate.
        </div>
      </form>
    </div>

    <div class="cardx">
      <h2 style="margin: 0 0 10px; font-size: 16px">Hasil</h2>

      {% if ai_result %}
      <textarea id="out" readonly>{{ ai_result }}</textarea>
      <div class="btnbar" style="margin-top: 10px">
        <button type="button" class="btn-ghost" id="btnCopy">üìã Copy</button>
      </div>
      <div class="mini" id="copyInfo"></div>
      {% else %}
      <textarea
        readonly
        placeholder="Hasil caption akan muncul di sini..."
      ></textarea>
      <div class="mini">Belum ada hasil. Isi form lalu klik Generate.</div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Super Loading -->
<div class="overlay" id="overlay">
  <div class="loader">
    <div class="loader-top">
      <div class="orb" aria-hidden="true"></div>
      <div class="loader-title">
        <h3>Menghasilkan caption</h3>
        <div class="typing">menyusun kata terbaik‚Ä¶</div>
      </div>
      <div class="sparkline" aria-hidden="true">
        <i style="height: 14px"></i><i style="height: 24px"></i
        ><i style="height: 34px"></i><i style="height: 22px"></i
        ><i style="height: 16px"></i>
      </div>
    </div>

    <div class="shimmer"></div>

    <div class="loader-body">
      <div class="chips">
        <div class="chip">üß† Tone <b>sesuai gaya</b></div>
        <div class="chip">üéØ CTA <b>ringkas</b></div>
        <div class="chip"># <b>hashtag</b></div>
      </div>
      <div class="hint">
        Tip: biar makin akurat, isi nama produk + harga (kalau ada).
      </div>
    </div>
  </div>
</div>

<script>
  const form = document.getElementById("capForm");
  const overlay = document.getElementById("overlay");
  const btnGen = document.getElementById("btnGen");

  form.addEventListener("submit", () => {
    overlay.classList.add("show");
    btnGen.disabled = true;
  });

  window.addEventListener("load", () => {
    overlay.classList.remove("show");
    btnGen.disabled = false;
  });

  document
    .getElementById("btnReset")
    .addEventListener("click", () => form.reset());

  const btnCopy = document.getElementById("btnCopy");
  if (btnCopy) {
    btnCopy.addEventListener("click", async () => {
      const out = document.getElementById("out");
      const info = document.getElementById("copyInfo");
      const text = (out.value || "").trim();
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        info.textContent = "‚úÖ Tersalin";
        setTimeout(() => (info.textContent = ""), 1200);
      } catch (e) {
        info.textContent = "‚ö†Ô∏è Gagal copy (browser blokir).";
      }
    });
  }
</script>
{% endblock %}
